<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>LoanGuru: A Coding Challenge</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

  <!-- Dev Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css">

  <!-- Prism CSS -->
  <link rel="stylesheet" href="/css/prism.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/site.css">
</head>

<body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark" id="main-nav">
      <div class="container">
        <a class="navbar-brand" href="/index.html">
          <!-- logo/Mark goes here -->
          <img src="/img/Color logo - no background2.png" class="d-none d-lg-inline" height="50" alt="">
          <img src="/img/logo-brand-mobile.png" class="d-lg-none" height="50" alt="">
          LoanGuru
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon-zd">
            <i class="bi bi-list"></i>
          </span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/app.html">The App</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/code.html">The Code</a>
            </li>
            <li class="nav-item">
              <!-- CHANGE THIS BEFORE PUBLISHING -->
              <a class="nav-link" href="https://github.com/dev-vader091/LoanGuruCalc-JS.git" target="_blank">The
                Repo</a>
            </li>
            <li class="nav-item">
              <!-- Lins to portfolio -->
              <a class="nav-link" href="#">About</a>
            </li>
            <li class="nav-item">
              <!-- TODO -->
              <a class="nav-link" href="#">Blog</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <main class="content container">
    <div class="row gy-2">
      <h1 class="border-bottom border-2 border-dark">The Code</h1>
      <!-- Source Code -->
      <div class="col-12 col-lg-8">
        <pre class="line-numbers">
          <code class="language-js">
            function getValues() {
              // get inputs from user
              let loanAmountInput = document.querySelector('#loanAmountInput').value;
              let loanTermInput = document.querySelector('#loanTermInput').value;
              let loanRateInput = document.querySelector('#loanRateInput').value;
              // function validate user inputs ran immediately after receiving inputs
              validateInputs(loanAmountInput, loanTermInput, loanRateInput);
              // validated inputs are then parsed into numbers to be used 
              // as parameters for calculate function
              let amount = parseInt(loanAmountInput);
              let term = parseInt(loanTermInput);
              let rate = parseFloat(loanRateInput);
              // create a value to hold the array returned in the calculate function
              // will be used as the parameter in the display function
              let loan = calculateLoan(amount, term, rate);
              
              // after calculation function - the returned array is used as the parameter
              // in the diplay function
              displayLoanTable(loan);
            }
          </code>
        </pre>
        <pre class="line-numbers">
          <code class="language-js">
            function calculateLoan(amount, term, rate) {
              // initialize variables to be used in calculation
              let currentBalance = amount;
              let totalMonthlyPayment = ((amount) * (rate / 1200)) / (1-(1 + rate / 1200) ** -term);
              let interestPayment;
              let principalPayment;
              let totalInterest = 0;
              // create an array to hold our monthly payment objects
              let loanArray = [];
              
              // for loop to calculate monthly payment info from variables created above
              // each month = i, start from the given balance(amount parameter) and decrease the amount/increase month each iteration
              for(i = 1; currentBalance > 0 ; i++ ){
                let currentMonth = i
                interestPayment = currentBalance * (rate / 1200);
                if (totalMonthlyPayment > currentBalance) {
                  totalMonthlyPayment = currentBalance + interestPayment;
                }
                principalPayment = totalMonthlyPayment - interestPayment;
                
                totalInterest += interestPayment;
                currentBalance -= principalPayment;
                let totalCost = amount + totalInterest;
            
                
                // end of each iteration -- create an object to hold monthly payment info to be pushed into array
                let loanStats = {
                month: currentMonth,
                payment: totalMonthlyPayment,
                principal: principalPayment,
                interest: interestPayment,
                interestTotal: totalInterest,
                balance: currentBalance,
                totalPrincipal: amount,
                total: totalCost
                }
                // push the loan stats object into the array
                loanArray.push(loanStats)
              }
            
              // return the final array of objects(will match term) as value to be used 
              // as parameter in display function
              return loanArray;
              // displayLoanTable(loanArray);
            }
          </code>
        </pre>
        <pre class="line-numbers">
          <code class="language-js">
            function displayLoanTable(loanArray) {
              // get our table body element from the document 
              let loanTable = document.getElementById('calcTable');
              // get the table row template from the document
              const tableRowTemplate = document.getElementById('tableRowTemplate');
              // initialize a variable that represents each array value
              let currentMonth;
              // Format the price above to USD using the locale, style, and currency.
              let USDollar = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
              });
            
              // empty the table body html 
              loanTable.innerHTML = '';
              // create table row with data from template that holds values for each loan object from 
              // loanArray parameter
              for(i = 0; i < loanArray.length; i++) {
                let loanRow = document.importNode(tableRowTemplate.content, true);
                // make our currentMonth value equal the current i
                currentMonth = loanArray[i];
                
                // create variable for table data to be added to row -- comes from template
                // in html (loanRow above)
                let tableCells = loanRow.querySelectorAll('td');
                // console.log(loanRow);
            
                // add our loan object data to the table row in each 
                tableCells[0].innerHTML = currentMonth.month;
                tableCells[1].innerHTML = USDollar.format(currentMonth.payment);
                tableCells[2].innerHTML = USDollar.format(currentMonth.principal);
                tableCells[3].innerHTML = USDollar.format(currentMonth.interest);
                tableCells[4].innerHTML = USDollar.format( currentMonth.interestTotal);
                tableCells[5].innerHTML = USDollar.format(currentMonth.balance);
            
                // at the end of each iteration -- add the row to the table html
                loanTable.appendChild(loanRow);
              }
            
              // display table with calculation results by getting elements from 
              // document and adding classes/html content 
              document.getElementById('loanSummary').classList.add('active');
              document.getElementById('tableContainer').classList.add('active');
              document.getElementById('monthlyPayment').innerHTML = USDollar.format(currentMonth.payment);
              document.getElementById('totalPrincipalAmount'). innerHTML = USDollar.format(currentMonth.totalPrincipal);
              document.getElementById('totalInterestAmount'). innerHTML = USDollar.format(currentMonth.interestTotal);
              document.getElementById('totalCost'). innerHTML = USDollar.format(currentMonth.total);
            }
          </code>
        </pre>
        <pre class="line-numbers">
          <code class="language-js">
            function validateInputs(amount, term, rate) {
              // check if our parsed inputs are negative or non-integers
              // if invalid, create an error alert asking for valid inputs
              if (isNaN(parseInt(amount)) || Math.sign(parseInt(amount)) == -1) {
                Swal.fire(
                      {
                      icon: 'error',
                      title: 'Oops...',
                      text: 'Please enter a valid loan amount.',
                    }
                  )
              }
              else if (isNaN(parseInt(term)) || Math.sign(parseInt(term)) == -1) {
                Swal.fire(
                      {
                      icon: 'error',
                      title: 'Oops...',
                      text: 'Please enter valid loan term.',
                    }
                    )
              }
              else if (isNaN(parseFloat(rate)) || Math.sign(parseFloat(rate)) == -1) {
                Swal.fire(
                      {
                      icon: 'error',
                      title: 'Oops...',
                      text: 'Please enter a valid loan interest rate.',
                    }
                    )
              }
              // if valid, return the inputs provided
              else {
                return amount, term, rate;
                // amount = parseInt(amount);
                // term = parseInt(term);
                // rate = parseFloat(rate);
                // calculateLoan(amount, term, rate);
              } 
            }
          </code>
        </pre>
      </div>
      <div class="col-12 col-lg-4">
        <h5 class="fs-2 fw-bold pb-3"><code>getValues()</code></h5>
        <p>This function displays the message in a Sweet Alert.</p>
        <h5 class="fs-2 fw-bold pb-3"><code>calculateLoan(amount, term, rate)</code></h5>
        <p>This function displays the message in a Sweet Alert.</p>
        <h5 class="fs-2 fw-bold pb-3"><code>displayLoanTable(loanArray)</code></h5>
        <p>This function displays the message in a Sweet Alert.</p>
        <h5 class="fs-2 fw-bold pb-3"><code>validateInputs(amount, term, rate)</code></h5>
        <p>This function displays the message in a Sweet Alert.</p>
      </div>
    </div>
  </main>


  <footer class="container-fluid py-3">
    <div class="container">
      <div class="row row-cols-1 row-cols-lg-3 align-items-center">
        <div class="col text-center text-lg-start order-last order-lg-first">
          &copy; 2023 Zeph Darden
        </div>
        <div class="col text-center">
          <!-- logo goes here -->
          <img src="/img/Color logo - no background2.png" height="50" alt="">
        </div>
        <div class="col text-center text-lg-end">
          <a href="#">
            <i class="bi bi-linkedin socialicons"></i></a>
          <a href="#">
            <i class="bi bi-twitter socialicons"></i></a>
          <a href="#">
            <i class="bi bi-youtube socialicons"></i></a>
          <a href="#">
            <i class="bi bi-github socialicons"></i></a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>

  <!-- Prism JS -->
  <script src="/js/prism.js"></script>
  <script>
    Prism.plugins.NormalizeWhitespace.setDefaults({
      'remove-trailing': true,
      'remove-indent': true,
      'left-trim': true,
      'right-trim': true
    })
  </script>
  <!-- Custom JS -->
  <!-- <script src="/js/site.js"></script> -->
</body>

</html>